<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRUTAL PORTFOLIO</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Archivo+Black&display=swap" rel="stylesheet">
    <style>
        /* BRUTALIST RESET */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Space Mono', monospace;
            -webkit-font-smoothing: none;
            -moz-osx-font-smoothing: none;
        }

        body {
            background-color: #0a0a0a;
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: relative;
            border: 12px solid #ff0a0a;
        }

        /* DESKTOP GRID */
        .desktop {
            width: 100%;
            height: calc(100% - 60px);
            position: relative;
            overflow: hidden;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 19px,
                    rgba(255, 10, 10, 0.03) 19px,
                    rgba(255, 10, 10, 0.03) 20px
                ),
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 19px,
                    rgba(255, 10, 10, 0.03) 19px,
                    rgba(255, 10, 10, 0.03) 20px
                );
        }

        /* TASKBAR - BRUTAL STYLE */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: #0a0a0a;
            border-top: 6px solid #ff0a0a;
            display: flex;
            align-items: center;
            padding: 0 15px;
            z-index: 1000;
            gap: 10px;
        }

        .start-button {
            height: 45px;
            padding: 0 20px;
            background: #ff0a0a;
            color: #0a0a0a;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 5px 5px 0px #ffffff;
            transition: all 0.1s;
        }

        .start-button:hover {
            transform: translate(2px, 2px);
            box-shadow: 3px 3px 0px #ffffff;
        }

        .start-button:active {
            transform: translate(5px, 5px);
            box-shadow: 0px 0px 0px #ffffff;
        }

        .taskbar-apps {
            display: flex;
            flex-grow: 1;
            gap: 8px;
            overflow-x: auto;
            padding: 5px 0;
        }

        .taskbar-app {
            height: 45px;
            padding: 0 15px;
            background-color: #0a0a0a;
            color: #ffffff;
            border: 2px solid #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            text-transform: uppercase;
            white-space: nowrap;
            min-width: 120px;
        }

        .taskbar-app.active {
            background-color: #ffffff;
            color: #0a0a0a;
        }

        .system-tray {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
        }

        .clock {
            color: #ffffff;
            font-size: 14px;
            font-weight: bold;
            padding: 8px 12px;
            background: #0a0a0a;
            border: 2px solid #ffffff;
        }

        /* DESKTOP ICONS - BRUTAL STYLE */
        .desktop-icon {
            position: absolute;
            width: 90px;
            height: 110px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            padding: 8px;
            border: 2px solid transparent;
            transition: all 0.2s;
            z-index: 10;
        }

        .desktop-icon:hover {
            border: 2px solid #ff0a0a;
            background: rgba(255, 10, 10, 0.05);
        }

        .desktop-icon.selected {
            border: 2px solid #ffffff;
            background: rgba(255, 255, 255, 0.1);
        }

        .icon-image {
            width: 54px;
            height: 54px;
            background-color: #ff0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0a0a0a;
            font-size: 24px;
            margin-bottom: 8px;
            border: 2px solid #ffffff;
            box-shadow: 3px 3px 0px #ffffff;
        }

        .icon-label {
            color: #ffffff;
            font-size: 11px;
            text-align: center;
            text-transform: uppercase;
            font-weight: bold;
            line-height: 1.2;
            max-width: 100%;
            background: #0a0a0a;
            padding: 2px 4px;
        }

        /* WINDOWS - BRUTAL STYLE */
        .window {
            position: absolute;
            background-color: #0a0a0a;
            border: 4px solid #ffffff;
            box-shadow: 8px 8px 0px #ff0a0a;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 100;
            min-width: 400px;
            min-height: 300px;
        }

        .window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: calc(100% - 60px) !important;
            border: 6px solid #ffffff;
            box-shadow: none;
        }

        .window-header {
            height: 40px;
            background: #ff0a0a;
            color: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            cursor: move;
            flex-shrink: 0;
            border-bottom: 3px solid #ffffff;
        }

        .window-title {
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .window-control {
            width: 22px;
            height: 22px;
            background: #0a0a0a;
            color: #ffffff;
            border: 2px solid #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .window-control:hover {
            background: #ffffff;
            color: #0a0a0a;
        }

        .window-content {
            flex-grow: 1;
            padding: 20px;
            overflow: auto;
            background-color: #0a0a0a;
            color: #ffffff;
        }

        .project-media {
            width: 100%;
            margin-bottom: 20px;
            border: 3px solid #ffffff;
        }

        .project-media img, .project-media video {
            width: 100%;
            display: block;
        }

        .project-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            color: #ff0a0a;
            border-bottom: 2px solid #ffffff;
            padding-bottom: 5px;
        }

        .project-description {
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .project-link {
            display: inline-block;
            padding: 8px 16px;
            background: #ff0a0a;
            color: #0a0a0a;
            text-decoration: none;
            font-weight: bold;
            text-transform: uppercase;
            border: 2px solid #ffffff;
            box-shadow: 3px 3px 0px #ffffff;
            transition: all 0.1s;
        }

        .project-link:hover {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0px #ffffff;
        }

        /* START MENU - BRUTAL STYLE */
        .start-menu {
            position: fixed;
            bottom: 60px;
            left: 0;
            width: 320px;
            height: 450px;
            background-color: #0a0a0a;
            border: 4px solid #ffffff;
            border-bottom: none;
            box-shadow: 8px -8px 0px #ff0a0a;
            display: none;
            flex-direction: column;
            z-index: 1001;
            overflow: hidden;
        }

        .start-menu-header {
            height: 80px;
            background: #ff0a0a;
            color: #0a0a0a;
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
            border-bottom: 3px solid #ffffff;
        }

        .start-menu-items {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px 0;
        }

        .start-menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid #333;
        }

        .start-menu-item:hover {
            background-color: #ff0a0a;
            color: #0a0a0a;
        }

        .start-menu-item-icon {
            width: 28px;
            height: 28px;
            margin-right: 15px;
            background-color: #ff0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0a0a0a;
            font-size: 14px;
            border: 2px solid #ffffff;
        }

        /* RESIZE HANDLE */
        .resize-handle {
            position: absolute;
            width: 20px;
            height: 20px;
            bottom: 0;
            right: 0;
            cursor: nwse-resize;
            z-index: 101;
            background: #ff0a0a;
            border-left: 2px solid #ffffff;
            border-top: 2px solid #ffffff;
        }

        /* CONTEXT MENU */
        .context-menu {
            position: absolute;
            background-color: #0a0a0a;
            border: 3px solid #ffffff;
            box-shadow: 5px 5px 0px #ff0a0a;
            padding: 5px 0;
            z-index: 1002;
            display: none;
        }

        .context-menu-item {
            padding: 10px 20px;
            cursor: pointer;
            font-size: 12px;
            text-transform: uppercase;
            transition: background-color 0.2s;
        }

        .context-menu-item:hover {
            background-color: #ff0a0a;
            color: #0a0a0a;
        }

        /* SYSTEM NOTIFICATION */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #0a0a0a;
            color: #ffffff;
            border: 3px solid #ff0a0a;
            box-shadow: 5px 5px 0px #ffffff;
            z-index: 2000;
            display: none;
        }

        /* BRUTALIST DECORATIVE ELEMENTS */
        .corner-decoration {
            position: absolute;
            width: 40px;
            height: 40px;
            z-index: 1;
        }

        .corner-tl {
            top: 0;
            left: 0;
            border-right: 12px solid transparent;
            border-bottom: 12px solid transparent;
            border-top: 12px solid #ff0a0a;
            border-left: 12px solid #ff0a0a;
        }

        .corner-tr {
            top: 0;
            right: 0;
            border-left: 12px solid transparent;
            border-bottom: 12px solid transparent;
            border-top: 12px solid #ff0a0a;
            border-right: 12px solid #ff0a0a;
        }

        .corner-bl {
            bottom: 60px;
            left: 0;
            border-right: 12px solid transparent;
            border-top: 12px solid transparent;
            border-bottom: 12px solid #ff0a0a;
            border-left: 12px solid #ff0a0a;
        }

        .corner-br {
            bottom: 60px;
            right: 0;
            border-left: 12px solid transparent;
            border-top: 12px solid transparent;
            border-bottom: 12px solid #ff0a0a;
            border-right: 12px solid #ff0a0a;
        }

        /* RESPONSIVE ADJUSTMENTS */
        @media (max-width: 768px) {
            body {
                border-width: 8px;
            }
            
            .desktop-icon {
                width: 80px;
                height: 100px;
            }
            
            .icon-image {
                width: 48px;
                height: 48px;
                font-size: 20px;
            }
            
            .window {
                min-width: 300px;
                min-height: 250px;
            }
            
            .start-menu {
                width: 280px;
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="corner-decoration corner-tl"></div>
    <div class="corner-decoration corner-tr"></div>
    <div class="corner-decoration corner-bl"></div>
    <div class="corner-decoration corner-br"></div>

    <div class="desktop" id="desktop">
        <!-- Desktop icons will be generated here -->
    </div>

    <div class="taskbar">
        <button class="start-button" id="startButton">SYSTEM</button>
        <div class="taskbar-apps" id="taskbarApps">
            <!-- Taskbar apps will be generated here -->
        </div>
        <div class="system-tray">
            <div class="clock" id="clock">00:00:00</div>
        </div>
    </div>

    <div class="start-menu" id="startMenu">
        <div class="start-menu-header">PORTFOLIO OS</div>
        <div class="start-menu-items" id="startMenuItems">
            <!-- Start menu items will be generated here -->
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" id="openContext">EXECUTE</div>
        <div class="context-menu-item" id="renameContext">RENAME</div>
        <div class="context-menu-item" id="deleteContext">DELETE</div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        SYSTEM: Portfolio OS Initialized
    </div>

    <script>
        // BRUTALIST PROJECT DATA
        const projects = [
            {
                id: 1,
                title: "BRUTAL ARCHITECTURE",
                icon: "ðŸ¢",
                type: "image",
                source: "https://images.unsplash.com/photo-1518002171953-f00013e10f4e?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                description: "Raw concrete structures exploring the intersection of form and function. This series examines the beauty in brutalist architectural principles applied to digital spaces."
            },
            {
                id: 2,
                title: "TYPOGRAPHY SYSTEM",
                icon: "ðŸ”¤",
                type: "image",
                source: "https://images.unsplash.com/photo-1558655146-9f40138edfeb?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                description: "A modular typographic system built on geometric principles. Each character is constructed from basic shapes to maintain visual consistency across scales."
            },
            {
                id: 3,
                title: "DIGITAL SCULPTURE",
                icon: "âš™ï¸",
                type: "video",
                source: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
                description: "Algorithmic generation of three-dimensional forms using parametric design principles. Each iteration explores the relationship between mathematical rules and aesthetic outcomes."
            },
            {
                id: 4,
                title: "INTERFACE STUDIES",
                icon: "ðŸ’ ",
                type: "image",
                source: "https://images.unsplash.com/photo-1558655146-364adaf1fcc9?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80",
                description: "A collection of user interface experiments that challenge conventional interaction patterns. Each study prioritizes function over decorative elements."
            },
            {
                id: 5,
                title: "CODE REPOSITORY",
                icon: "ðŸ“Ÿ",
                type: "link",
                source: "https://github.com",
                description: "Access to the underlying code structures and experimental frameworks. All projects are documented with technical specifications and development notes."
            },
            {
                id: 6,
                title: "SOUND EXPERIMENTS",
                icon: "ðŸ”Š",
                type: "video",
                source: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4",
                description: "Generative audio compositions created through algorithmic processes. Each piece explores the relationship between visual patterns and sonic structures."
            }
        ];

        // DOM Elements
        const desktop = document.getElementById('desktop');
        const startButton = document.getElementById('startButton');
        const startMenu = document.getElementById('startMenu');
        const startMenuItems = document.getElementById('startMenuItems');
        const taskbarApps = document.getElementById('taskbarApps');
        const clock = document.getElementById('clock');
        const contextMenu = document.getElementById('contextMenu');
        const notification = document.getElementById('notification');

        // State variables
        let activeWindow = null;
        let zIndexCounter = 100;
        let draggedElement = null;
        let offsetX = 0, offsetY = 0;
        let isResizing = false;
        let resizeElement = null;

        // Initialize the desktop
        function initDesktop() {
            loadDesktopState();
            createDesktopIcons();
            updateClock();
            setInterval(updateClock, 1000);
            showNotification('SYSTEM: Portfolio OS Initialized');

            // Event listeners
            document.addEventListener('mousedown', handleMouseDown);
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
            
            document.addEventListener('touchstart', handleTouchStart, { passive: false });
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
            
            startButton.addEventListener('click', toggleStartMenu);
            document.addEventListener('click', closeStartMenu);
            
            // Context menu
            desktop.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                showContextMenu(e.pageX, e.pageY);
            });
            
            // Context menu actions
            document.getElementById('openContext').addEventListener('click', openFromContextMenu);
            document.getElementById('renameContext').addEventListener('click', renameFromContextMenu);
            document.getElementById('deleteContext').addEventListener('click', deleteFromContextMenu);
            
            // Close context menu on click elsewhere
            document.addEventListener('click', () => {
                contextMenu.style.display = 'none';
            });
        }

        // Show system notification
        function showNotification(message) {
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Load desktop state from localStorage
        function loadDesktopState() {
            const savedState = localStorage.getItem('brutalDesktopState');
            if (savedState) {
                return JSON.parse(savedState);
            }
            return null;
        }

        // Save desktop state to localStorage
        function saveDesktopState() {
            const icons = document.querySelectorAll('.desktop-icon');
            const iconPositions = [];
            
            icons.forEach(icon => {
                iconPositions.push({
                    id: icon.dataset.id,
                    x: parseInt(icon.style.left),
                    y: parseInt(icon.style.top)
                });
            });
            
            const state = {
                icons: iconPositions,
            };
            
            localStorage.setItem('brutalDesktopState', JSON.stringify(state));
        }

        // Create desktop icons
        function createDesktopIcons() {
            const savedState = loadDesktopState();
            
            projects.forEach(project => {
                const icon = document.createElement('div');
                icon.className = 'desktop-icon';
                icon.dataset.id = project.id;
                
                // Set position from saved state or default
                if (savedState && savedState.icons) {
                    const savedIcon = savedState.icons.find(i => i.id == project.id);
                    if (savedIcon) {
                        icon.style.left = `${savedIcon.x}px`;
                        icon.style.top = `${savedIcon.y}px`;
                    } else {
                        // Grid position for new icons
                        const col = (project.id - 1) % 4;
                        const row = Math.floor((project.id - 1) / 4);
                        icon.style.left = `${100 + col * 120}px`;
                        icon.style.top = `${80 + row * 140}px`;
                    }
                } else {
                    // Grid position for first time
                    const col = (project.id - 1) % 4;
                    const row = Math.floor((project.id - 1) / 4);
                    icon.style.left = `${100 + col * 120}px`;
                    icon.style.top = `${80 + row * 140}px`;
                }
                
                icon.innerHTML = `
                    <div class="icon-image">${project.icon}</div>
                    <div class="icon-label">${project.title}</div>
                `;
                
                // Double click to open project
                icon.addEventListener('dblclick', () => openProject(project));
                icon.addEventListener('mousedown', startDragIcon);
                icon.addEventListener('touchstart', startDragIcon);
                
                // Add to start menu
                const startMenuItem = document.createElement('div');
                startMenuItem.className = 'start-menu-item';
                startMenuItem.innerHTML = `
                    <div class="start-menu-item-icon">${project.icon}</div>
                    <div>${project.title}</div>
                `;
                startMenuItem.addEventListener('click', () => {
                    openProject(project);
                    closeStartMenu();
                });
                startMenuItems.appendChild(startMenuItem);
                
                desktop.appendChild(icon);
            });
        }

        // Open a project in a window
        function openProject(project) {
            // Close existing window if already open
            const existingWindow = document.querySelector(`[data-project-id="${project.id}"]`);
            if (existingWindow) {
                bringToFront(existingWindow);
                return;
            }
            
            // Create window
            const window = document.createElement('div');
            window.className = 'window';
            window.dataset.projectId = project.id;
            
            // Set initial position and size
            window.style.left = '150px';
            window.style.top = '80px';
            window.style.width = '700px';
            window.style.height = '500px';
            
            // Window content based on project type
            let mediaContent = '';
            if (project.type === 'image') {
                mediaContent = `<img src="${project.source}" alt="${project.title}">`;
            } else if (project.type === 'video') {
                mediaContent = `
                    <video controls>
                        <source src="${project.source}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                `;
            } else if (project.type === 'link') {
                mediaContent = `<div style="height: 300px; background: #ff0a0a; display: flex; align-items: center; justify-content: center; color: #0a0a0a; font-weight: bold; font-size: 24px;">EXTERNAL RESOURCE</div>`;
            }
            
            window.innerHTML = `
                <div class="window-header">
                    <div class="window-title">${project.title}</div>
                    <div class="window-controls">
                        <div class="window-control minimize">âˆ’</div>
                        <div class="window-control maximize">â–¡</div>
                        <div class="window-control close">Ã—</div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="project-media">
                        ${mediaContent}
                    </div>
                    <div class="project-title">${project.title}</div>
                    <div class="project-description">${project.description}</div>
                    ${project.type === 'link' ? `<a href="${project.source}" target="_blank" class="project-link">ACCESS RESOURCE</a>` : ''}
                </div>
                <div class="resize-handle"></div>
            `;
            
            desktop.appendChild(window);
            bringToFront(window);
            
            // Add to taskbar
            addToTaskbar(project, window);
            
            // Window controls
            const minimizeBtn = window.querySelector('.minimize');
            const maximizeBtn = window.querySelector('.maximize');
            const closeBtn = window.querySelector('.close');
            const resizeHandle = window.querySelector('.resize-handle');
            
            minimizeBtn.addEventListener('click', () => minimizeWindow(window));
            maximizeBtn.addEventListener('click', () => toggleMaximize(window));
            closeBtn.addEventListener('click', () => closeWindow(window));
            
            // Make window draggable
            const header = window.querySelector('.window-header');
            header.addEventListener('mousedown', startDrag);
            header.addEventListener('touchstart', startDragTouch);
            
            // Make window resizable
            resizeHandle.addEventListener('mousedown', startResize);
            resizeHandle.addEventListener('touchstart', startResizeTouch);
            
            showNotification(`SYSTEM: ${project.title} loaded`);
        }

        // Add window to taskbar
        function addToTaskbar(project, window) {
            const taskbarApp = document.createElement('div');
            taskbarApp.className = 'taskbar-app';
            taskbarApp.textContent = project.title;
            taskbarApp.dataset.windowId = project.id;
            
            taskbarApp.addEventListener('click', () => {
                if (window.style.display === 'none') {
                    restoreWindow(window);
                } else {
                    bringToFront(window);
                }
            });
            
            taskbarApps.appendChild(taskbarApp);
        }

        // Bring window to front
        function bringToFront(window) {
            zIndexCounter++;
            window.style.zIndex = zIndexCounter;
            activeWindow = window;
            
            // Update taskbar active state
            document.querySelectorAll('.taskbar-app').forEach(app => {
                app.classList.remove('active');
            });
            
            const taskbarApp = document.querySelector(`[data-window-id="${window.dataset.projectId}"]`);
            if (taskbarApp) {
                taskbarApp.classList.add('active');
            }
        }

        // Minimize window
        function minimizeWindow(window) {
            window.style.display = 'none';
            showNotification(`SYSTEM: ${window.querySelector('.window-title').textContent} minimized`);
        }

        // Restore window
        function restoreWindow(window) {
            window.style.display = 'flex';
            bringToFront(window);
            showNotification(`SYSTEM: ${window.querySelector('.window-title').textContent} restored`);
        }

        // Toggle maximize/restore window
        function toggleMaximize(window) {
            if (window.classList.contains('maximized')) {
                window.classList.remove('maximized');
                showNotification(`SYSTEM: Window restored`);
            } else {
                window.classList.add('maximized');
                showNotification(`SYSTEM: Window maximized`);
            }
        }

        // Close window
        function closeWindow(window) {
            const projectId = window.dataset.projectId;
            const title = window.querySelector('.window-title').textContent;
            
            // Remove from taskbar
            const taskbarApp = document.querySelector(`[data-window-id="${projectId}"]`);
            if (taskbarApp) {
                taskbarApp.remove();
            }
            
            // Remove window
            window.remove();
            showNotification(`SYSTEM: ${title} closed`);
        }

        // Start dragging window or icon
        function startDrag(e) {
            if (e.button !== 0 && e.type !== 'touchstart') return;
            
            draggedElement = e.target.closest('.window');
            if (!draggedElement) return;
            
            bringToFront(draggedElement);
            
            const rect = draggedElement.getBoundingClientRect();
            if (e.type === 'mousedown') {
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;
            } else {
                offsetX = e.touches[0].clientX - rect.left;
                offsetY = e.touches[0].clientY - rect.top;
            }
            
            e.preventDefault();
        }

        // Start dragging for desktop icons
        function startDragIcon(e) {
            if (e.button !== 0 && e.type !== 'touchstart') return;
            
            draggedElement = e.target.closest('.desktop-icon');
            if (!draggedElement) return;
            
            const rect = draggedElement.getBoundingClientRect();
            if (e.type === 'mousedown') {
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;
            } else {
                offsetX = e.touches[0].clientX - rect.left;
                offsetY = e.touches[0].clientY - rect.top;
            }
            
            e.preventDefault();
        }

        // Handle mouse movement for dragging
        function handleMouseMove(e) {
            if (!draggedElement) return;
            
            if (isResizing) {
                // Resize logic
                const newWidth = e.clientX - parseInt(draggedElement.style.left);
                const newHeight = e.clientY - parseInt(draggedElement.style.top);
                
                if (newWidth > 300) draggedElement.style.width = `${newWidth}px`;
                if (newHeight > 200) draggedElement.style.height = `${newHeight}px`;
            } else {
                // Dragging logic
                let x = e.clientX - offsetX;
                let y = e.clientY - offsetY;
                
                // Boundary checks
                if (x < 0) x = 0;
                if (y < 0) y = 0;
                if (x + draggedElement.offsetWidth > window.innerWidth) {
                    x = window.innerWidth - draggedElement.offsetWidth;
                }
                if (y + draggedElement.offsetHeight > window.innerHeight - 60) {
                    y = window.innerHeight - draggedElement.offsetHeight - 60;
                }
                
                draggedElement.style.left = `${x}px`;
                draggedElement.style.top = `${y}px`;
            }
        }

        // Handle touch movement for dragging
        function handleTouchMove(e) {
            if (!draggedElement || e.touches.length !== 1) return;
            
            const touch = e.touches[0];
            
            if (isResizing) {
                // Resize logic
                const newWidth = touch.clientX - parseInt(draggedElement.style.left);
                const newHeight = touch.clientY - parseInt(draggedElement.style.top);
                
                if (newWidth > 300) draggedElement.style.width = `${newWidth}px`;
                if (newHeight > 200) draggedElement.style.height = `${newHeight}px`;
            } else {
                // Dragging logic
                let x = touch.clientX - offsetX;
                let y = touch.clientY - offsetY;
                
                // Boundary checks
                if (x < 0) x = 0;
                if (y < 0) y = 0;
                if (x + draggedElement.offsetWidth > window.innerWidth) {
                    x = window.innerWidth - draggedElement.offsetWidth;
                }
                if (y + draggedElement.offsetHeight > window.innerHeight - 60) {
                    y = window.innerHeight - draggedElement.offsetHeight - 60;
                }
                
                draggedElement.style.left = `${x}px`;
                draggedElement.style.top = `${y}px`;
            }
            
            e.preventDefault();
        }

        // Stop dragging
        function handleMouseUp() {
            if (draggedElement && draggedElement.classList.contains('desktop-icon')) {
                saveDesktopState();
            }
            draggedElement = null;
            isResizing = false;
            resizeElement = null;
        }

        // Stop dragging for touch
        function handleTouchEnd() {
            if (draggedElement && draggedElement.classList.contains('desktop-icon')) {
                saveDesktopState();
            }
            draggedElement = null;
            isResizing = false;
            resizeElement = null;
        }

        // Start resize
        function startResize(e) {
            if (e.button !== 0) return;
            
            isResizing = true;
            resizeElement = e.target.closest('.window');
            bringToFront(resizeElement);
            
            e.preventDefault();
            e.stopPropagation();
        }

        // Start resize for touch
        function startResizeTouch(e) {
            isResizing = true;
            resizeElement = e.target.closest('.window');
            bringToFront(resizeElement);
            
            e.preventDefault();
            e.stopPropagation();
        }

        // Handle mouse down for desktop icons and windows
        function handleMouseDown(e) {
            // Check if clicking on desktop icon
            if (e.target.closest('.desktop-icon')) {
                startDragIcon(e);
            }
            
            // Check if clicking on window header
            if (e.target.closest('.window-header')) {
                startDrag(e);
            }
            
            // Check if clicking on resize handle
            if (e.target.closest('.resize-handle')) {
                startResize(e);
            }
            
            // Deselect all icons when clicking on desktop
            if (e.target === desktop) {
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    icon.classList.remove('selected');
                });
            }
        }

        // Handle touch start for desktop icons and windows
        function handleTouchStart(e) {
            // Check if touching desktop icon
            if (e.target.closest('.desktop-icon')) {
                startDragIcon(e);
            }
            
            // Check if touching window header
            if (e.target.closest('.window-header')) {
                startDrag(e);
            }
            
            // Check if touching resize handle
            if (e.target.closest('.resize-handle')) {
                startResizeTouch(e);
            }
            
            // Deselect all icons when touching desktop
            if (e.target === desktop) {
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    icon.classList.remove('selected');
                });
            }
        }

        // Toggle start menu
        function toggleStartMenu() {
            if (startMenu.style.display === 'flex') {
                startMenu.style.display = 'none';
            } else {
                startMenu.style.display = 'flex';
            }
        }

        // Close start menu
        function closeStartMenu(e) {
            if (e && e.target !== startButton && !startMenu.contains(e.target)) {
                startMenu.style.display = 'none';
            }
        }

        // Update clock
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            clock.textContent = timeString;
        }

        // Show context menu
        function showContextMenu(x, y) {
            contextMenu.style.left = `${x}px`;
            contextMenu.style.top = `${y}px`;
            contextMenu.style.display = 'block';
        }

        // Open from context menu
        function openFromContextMenu() {
            // Implementation for opening from context menu
            contextMenu.style.display = 'none';
        }

        // Rename from context menu
        function renameFromContextMenu() {
            // Implementation for renaming from context menu
            contextMenu.style.display = 'none';
        }

        // Delete from context menu
        function deleteFromContextMenu() {
            // Implementation for deleting from context menu
            contextMenu.style.display = 'none';
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initDesktop);
    </script>
</body>
</html>
